# üîê –Ø–ö –ü–†–ê–¶–Æ–Ñ –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø –¢–ê –î–û–°–¢–£–ü –î–û –ë–î

## ‚ùì –ü–∏—Ç–∞–Ω–Ω—è: –Ø–∫—â–æ —Å–∫—Ä–∏–ø—Ç –Ω–µ –º–æ–∂–µ –¥–æ–¥–∞—Ç–∏ –¥–∞–Ω—ñ, —Ç–æ —è–∫ –¥–æ–¥–∞—Ç–æ–∫ –∑–º–æ–∂–µ?

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –°–∫—Ä–∏–ø—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥. –î–æ–¥–∞—Ç–æ–∫ –ø—Ä–∞—Ü—é—î —ñ–Ω–∞–∫—à–µ!

---

## üîë –î–í–ê –¢–ò–ü–ò –ö–õ–Æ–ß–Ü–í SUPABASE:

### 1Ô∏è‚É£ **ANON KEY** (–ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á)
```javascript
// –¶–µ–π –∫–ª—é—á —î –≤ .env —Ñ–∞–π–ª—ñ
EXPO_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...

// ‚úÖ –ú–æ–∂–µ: —á–∏—Ç–∞—Ç–∏/–ø–∏—Å–∞—Ç–∏ –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
// ‚ùå –ù–ï –º–æ–∂–µ: admin –æ–ø–µ—Ä–∞—Ü—ñ—ó, –æ–±—Ö–æ–¥–∏—Ç–∏ RLS
```

### 2Ô∏è‚É£ **SERVICE ROLE KEY** (–ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á)
```javascript
// –¶–µ–π –∫–ª—é—á –ù–Ü–ö–û–õ–ò –Ω–µ –¥–æ–¥–∞—î—Ç—å—Å—è –≤ –¥–æ–¥–∞—Ç–æ–∫!
// –¢—ñ–ª—å–∫–∏ –¥–ª—è backend —Å–µ—Ä–≤–µ—Ä—ñ–≤

// ‚úÖ –ú–æ–∂–µ: –≤—Å–µ (admin –¥–æ—Å—Ç—É–ø)
// ‚ö†Ô∏è –ù–ï–ë–ï–ó–ü–ï–ß–ù–û –≤ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–º—É –∫–æ–¥—ñ!
```

---

## ‚ùå –ß–û–ú–£ –ú–Ü–ô –ü–ï–†–®–ò–ô –°–ö–†–ò–ü–¢ –ù–ï –°–ü–†–ê–¶–Æ–í–ê–í:

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
const supabase = createClient(supabaseUrl, ANON_KEY);

// –ù–∞–º–∞–≥–∞–≤—Å—è –≤–∏–∫–ª–∏–∫–∞—Ç–∏ admin API
const users = await supabase.auth.admin.listUsers();
// Error: "User not allowed" ‚ùå
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `admin.listUsers()` –ø–æ—Ç—Ä–µ–±—É—î SERVICE ROLE KEY

---

## ‚úÖ –Ø–ö –ü–†–ê–¶–Æ–Ñ –î–û–î–ê–¢–û–ö:

### –ö—Ä–æ–∫ 1: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
```javascript
// –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å email + password
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'luhobymer@gmail.com',
  password: 'my_secret_password'
});

// Supabase –ø–æ–≤–µ—Ä—Ç–∞—î:
// - Access Token (JWT)
// - Refresh Token
// - User object
```

### –ö—Ä–æ–∫ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π JWT Token
```javascript
// –ü—ñ—Å–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó, SDK –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –¥–æ–¥–∞—î JWT –¥–æ –≤—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤
const { data, error } = await supabase
  .from('cars')
  .insert({ brand: 'Toyota', model: 'Camry' });

// –ó–∞ –∫—É–ª—ñ—Å–∞–º–∏:
// Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### –ö—Ä–æ–∫ 3: RLS –ø–µ—Ä–µ–≤—ñ—Ä—è—î JWT
```sql
-- –í –ë–î —î –ø–æ–ª—ñ—Ç–∏–∫–∞:
CREATE POLICY "Users can insert own cars"
ON cars FOR INSERT
WITH CHECK (
  auth.uid() = user_id  -- ‚úÖ auth.uid() –±–µ—Ä–µ—Ç—å—Å—è –∑ JWT token
);
```

### –ö—Ä–æ–∫ 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è user_id
```javascript
// –í –¥–æ–¥–∞—Ç–∫—É –º–æ–∂–Ω–∞ –Ω–∞–≤—ñ—Ç—å –Ω–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ user_id
const { data, error } = await supabase
  .from('cars')
  .insert({
    brand: 'Toyota',
    model: 'Camry'
    // user_id –¥–æ–¥–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ trigger –∞–±–æ default
  });
```

---

## üîÑ –ü–û–†–Ü–í–ù–Ø–ù–ù–Ø:

| –ê—Å–ø–µ–∫—Ç | –°–∫—Ä–∏–ø—Ç –ë–ï–ó auth | –°–∫—Ä–∏–ø—Ç –ó auth | –î–æ–¥–∞—Ç–æ–∫ |
|--------|-----------------|---------------|---------|
| **–ö–ª—é—á** | ANON KEY | ANON KEY | ANON KEY |
| **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è** | ‚ùå –ù–µ–º–∞—î | ‚úÖ –Ñ | ‚úÖ –Ñ |
| **JWT Token** | ‚ùå –ù–µ–º–∞—î | ‚úÖ –Ñ | ‚úÖ –Ñ |
| **auth.uid()** | ‚ùå NULL | ‚úÖ user_id | ‚úÖ user_id |
| **RLS** | ‚ùå –ë–ª–æ–∫—É—î | ‚úÖ –î–æ–∑–≤–æ–ª—è—î | ‚úÖ –î–æ–∑–≤–æ–ª—è—î |
| **–î–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö** | ‚ùå | ‚úÖ | ‚úÖ |

---

## üíª –í–ò–ü–†–ê–í–õ–ï–ù–ò–ô –°–ö–†–ò–ü–¢:

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
```bash
# –ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
node scripts/add-test-data-with-auth.js YOUR_PASSWORD
```

### –©–æ —Ä–æ–±–∏—Ç—å:
1. ‚úÖ –õ–æ–≥—ñ–Ω–∏—Ç—å—Å—è —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
2. ‚úÖ –û—Ç—Ä–∏–º—É—î JWT token
3. ‚úÖ –î–æ–¥–∞—î –¥–∞–Ω—ñ (RLS –¥–æ–∑–≤–æ–ª—è—î)
4. ‚úÖ –í–∏—Ö–æ–¥–∏—Ç—å –∑ —Å–∏—Å—Ç–µ–º–∏

---

## üõ°Ô∏è RLS (ROW LEVEL SECURITY)

### –©–æ —Ü–µ?
RLS - —Ü–µ –ø–æ–ª—ñ—Ç–∏–∫–∏ –±–µ–∑–ø–µ–∫–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ —Ä—è–¥–∫—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ.

### –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–ª—ñ—Ç–∏–∫–∏:
```sql
-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ —á–∏—Ç–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –°–í–û–á –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ
CREATE POLICY "Users can view own cars"
ON cars FOR SELECT
USING (auth.uid() = user_id);

-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –¥–æ–¥–∞–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –î–õ–Ø –°–ï–ë–ï
CREATE POLICY "Users can insert own cars"
ON cars FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –°–í–û–á
CREATE POLICY "Users can update own cars"
ON cars FOR UPDATE
USING (auth.uid() = user_id);
```

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:
```javascript
// –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A (id: aaa-111)
await supabase.from('cars').select();
// –ü–æ–≤–µ—Ä—Ç–∞—î —Ç—ñ–ª—å–∫–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ –¥–µ user_id = 'aaa-111'

// –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B (id: bbb-222) 
await supabase.from('cars').select();
// –ü–æ–≤–µ—Ä—Ç–∞—î —Ç—ñ–ª—å–∫–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ –¥–µ user_id = 'bbb-222'

// ‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A –ù–ï –±–∞—á–∏—Ç—å –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ B
```

---

## üîí –ë–ï–ó–ü–ï–ö–ê:

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
```javascript
// –í –¥–æ–¥–∞—Ç–∫—É
const supabase = createClient(
  SUPABASE_URL,
  ANON_KEY  // ‚úÖ –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á
);

// –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑—É—î—Ç—å—Å—è
await supabase.auth.signInWithPassword({...});

// –ü—Ä–∞—Ü—é—î –∑ –¥–∞–Ω–∏–º–∏
await supabase.from('cars').select();
```

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
```javascript
// ‚ùå –ù–Ü–ö–û–õ–ò –Ω–µ —Ä–æ–±—ñ—Ç—å —Ç–∞–∫!
const supabase = createClient(
  SUPABASE_URL,
  SERVICE_ROLE_KEY  // ‚ùå –ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á –≤ –∫–ª—ñ—î–Ω—Ç—ñ!
);

// ‚ùå –û–±—Ö–æ–¥–∏—Ç—å –≤—Å—ñ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏
// ‚ùå –ë—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ –≤–∏—Ç—è–≥—Ç–∏ –∫–ª—é—á –∑ –∫–æ–¥—É
// ‚ùå –ú–∞—î –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –ë–î
```

---

## üéØ –í–ò–°–ù–û–í–û–ö:

### –ß–æ–º—É —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–≤:
- ‚ùå –ù–µ –±—É–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- ‚ùå –ù–µ –±—É–ª–æ JWT token
- ‚ùå RLS –±–ª–æ–∫—É–≤–∞–≤ –¥–æ—Å—Ç—É–ø

### –ß–æ–º—É –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ:
- ‚úÖ –Ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
- ‚úÖ –Ñ JWT token
- ‚úÖ RLS –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø
- ‚úÖ –ö–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ

### –Ø–∫ –¥–æ–¥–∞—Ç–∏ –¥–∞–Ω—ñ –ü–†–ê–í–ò–õ–¨–ù–û:
1. **–í–∞—Ä—ñ–∞–Ω—Ç A:** SQL –≤ Supabase Dashboard (–æ–±—Ö–æ–¥–∏—Ç—å RLS)
2. **–í–∞—Ä—ñ–∞–Ω—Ç B:** –°–∫—Ä–∏–ø—Ç –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é (`add-test-data-with-auth.js`)
3. **–í–∞—Ä—ñ–∞–Ω—Ç C:** –ß–µ—Ä–µ–∑ —Å–∞–º –¥–æ–¥–∞—Ç–æ–∫ (–Ω–∞–π–ø—Ä–∞–≤–∏–ª—å–Ω—ñ—à–µ)

---

## üìö –î–û–î–ê–¢–ö–û–í–Ü –†–ï–°–£–†–°–ò:

- [Supabase Auth Docs](https://supabase.com/docs/guides/auth)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)
- [JWT Tokens](https://jwt.io/)

---

## üöÄ –®–í–ò–î–ö–ò–ô –°–¢–ê–†–¢:

```bash
# 1. –î–æ–¥–∞–π—Ç–µ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
node scripts/add-test-data-with-auth.js YOUR_PASSWORD

# 2. –ê–±–æ –≤–∏–∫–æ–Ω–∞–π—Ç–µ SQL –≤ Supabase Dashboard
# (–¥–∏–≤. scripts/add-test-data.sql)

# 3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤ –¥–æ–¥–∞—Ç–∫—É
npm run web
# –û–Ω–æ–≤—ñ—Ç—å –±—Ä–∞—É–∑–µ—Ä (Ctrl+R)
```

**–¢–µ–ø–µ—Ä –≤—Å–µ –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏!** ‚úÖ
